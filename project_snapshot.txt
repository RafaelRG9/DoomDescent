git ls-files | grep -E "\.(cs|md|json|csproj)$" | xargs -I {} sh -c 'echo "--- {} ---"; cat {}; echo ""' > project_snapshot.txt


--- .vscode/settings.json ---
{}
--- Abilities/Ability.cs ---
using csharp_roguelike_rpg.Characters;
namespace csharp_roguelike_rpg.Abilities;

public abstract class Ability
{
    public string? Name { get; protected set; }
    public string? Description { get; protected set; }
    public int EnergyCost { get; protected set; }

    public abstract void Use(Character caster, Character target);
}
--- Abilities/DoubleStrike.cs ---
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Systems;
namespace csharp_roguelike_rpg.Abilities;

public class DoubleStrike : Ability
{
    public DoubleStrike()
    {
        Name = "Double Strike";
        Description = "You sly fox quick as a fox (redundant as hitting twice). Hit the target twice for 75% of your Dexterity as damage";
        EnergyCost = 5;
    }

    public override void Use(Character caster, Character target)
    {
        // Each hit does 75% of the caster's Dexterity as damage
        int damagePerHit = (int)(caster.GetTotalStrength() * 0.75);

        // First Hit
        target.Health -= damagePerHit;
        UIManager.SlowPrint($"{caster.Name} strikes quickly, dealing {damagePerHit} damage!", ConsoleColor.Yellow);

        // If target is still alive, hit a second time
        if (target.Health > 0)
        {
            target.Health -= damagePerHit;
            UIManager.SlowPrint($"{caster.Name} follows up with a second strike, dealing {damagePerHit} damage!", ConsoleColor.Yellow);
        }
    }
}
--- Abilities/Fireball.cs ---
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Systems;
namespace csharp_roguelike_rpg.Abilities;

public class Fireball : Ability
{
    public Fireball()
    {
        Name = "Fireball";
        Description = "These are small rooms, what's the worst that could happen?. Hit the target with a huge fireball for 200% of Intellect as damage";
        EnergyCost = 5;
    }

    public override void Use(Character caster, Character target)
    {
        // Fireball deals 200% of the caster's Intellect as damage
        int damage = caster.Stats["Intellect"] * 2;
        target.Health -= damage;
        UIManager.SlowPrint($"{caster.Name} hurls a ball of fire at {target.Name}, dealing {damage} damage!", ConsoleColor.Red);
    }
}
--- Abilities/PowerAttack.cs ---
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Systems;
namespace csharp_roguelike_rpg.Abilities;

public class PowerAttack : Ability
{
    public PowerAttack()
    {
        Name = "Power Attack";
        Description = "Hurr Durr Warrior hit strong. Deals 150% of Strength as damage";
        EnergyCost = 5;
    }

    public override void Use(Character caster, Character target)
    {
        // Power Attack deals 150% of the caster's Strength as damage
        int damage = (int)(caster.GetTotalStrength() * 1.5);
        target.Health -= damage;
        UIManager.SlowPrint($"{caster.Name} uses {Name}, dealing {damage} damage to {target.Name}!");
    }
}
--- Characters/AnimatedSkeleton.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;

public class AnimatedSkeleton : Monster
{
    public AnimatedSkeleton(Item? loot)
        : base("Animated Skeleton", 15, 6, 12, 40, 1, loot)
    {

    }
}
--- Characters/Boss.cs ---
using csharp_roguelike_rpg.Items;
namespace csharp_roguelike_rpg.Characters;

public class Boss : Monster
{
    public Boss(Item? bossLoot)
        : base("Ignis, the Ancient Flame", 500, 30, 10, 20000, 20, bossLoot)
    {

    }
}
--- Characters/BossGoblinKing.cs ---
using csharp_roguelike_rpg.Items;
namespace csharp_roguelike_rpg.Characters;

public class BossGoblinKing : Monster
{
    public BossGoblinKing(Item? bossLoot)
        : base("Goblin King Gnash", 80, 14, 8, 500, 6, bossLoot)
    {

    }
}
--- Characters/BossLichLord.cs ---
using csharp_roguelike_rpg.Items;
namespace csharp_roguelike_rpg.Characters;

public class BossLichLord : Monster
{
    public BossLichLord(Item? bossLoot)
        : base("Lich Lord Azmoth", 100, 8, 10, 2500, 20, bossLoot)
    {

    }
}
--- Characters/BossMinotaur.cs ---
using csharp_roguelike_rpg.Items;
namespace csharp_roguelike_rpg.Characters;

public class BossMinotaurGuardian : Monster
{
    public BossMinotaurGuardian(Item? bossLoot)
        : base("Minotaur Guardian", 180, 22, 12, 1200, 5, bossLoot)
    {

    }
}
--- Characters/BossTrollChieftain.cs ---
using csharp_roguelike_rpg.Items;
namespace csharp_roguelike_rpg.Characters;

public class BossTrollChieftain : Monster
{
    public BossTrollChieftain(Item? bossLoot)
        : base("Troll Chieftain Grokk", 150, 18, 2, 1200, 3, bossLoot)
    {

    }
}
--- Characters/BossVampCount.cs ---
using csharp_roguelike_rpg.Items;
namespace csharp_roguelike_rpg.Characters;

public class BossVampCount : Monster
{
    public BossVampCount(Item? bossLoot)
        : base("Vampire Count Valerius", 200, 18, 18, 7500, 15, bossLoot)
    {

    }
}
--- Characters/Character.cs ---
namespace csharp_roguelike_rpg.Characters;

public abstract class Character
{
    public string Name { get; set; }
    public int Health { get; set; }
    public int MaxHealth { get; set; }
    public int Energy { get; set; }
    public int MaxEnergy { get; set; }
    public int Lifesteal { get; set; }
    public Dictionary<string, int> Stats { get; private set; }
    public bool IsDefending { get; set; }

    public Character(string name, int health, int strength, int dexterity, int intellect, int lifesteal = 0)
    {
        Name = name;
        MaxHealth = health;
        Health = health;
        Stats = new Dictionary<string, int>
        {
            {"Strength", strength},
            {"Dexterity", dexterity},
            {"Intellect", intellect },
            {"Lifesteal", lifesteal}
        };
    }

    public virtual int GetTotalStrength()
    {
        return Stats["Strength"];
    }

    public virtual int GetTotalDefense()
    {
        return 0;
    }
}
--- Characters/CorrosiveSlime.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;

public class CorrosiveSlime : Monster
{
    public CorrosiveSlime(Item? loot)
        : base("Corrosive Slime", 30, 7, 2, 35, 1, loot)
    {

    }
}
--- Characters/FireImp.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;

public class FireImp : Monster
{
    public FireImp(Item? loot)
        : base("Fire Imp", 12, 3, 14, 70, 8, loot)
    {

    }
}
--- Characters/GiantSpider.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;

public class GiantSpider : Monster
{
    public GiantSpider(Item? loot)
        : base("Giant Spider", 25, 9, 15, 80, 2, loot)
    {

    }
}
--- Characters/Goblin.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;
public class Goblin : Monster
{
    public Goblin(Item? loot)
        : base("Goblin", 20, 8, 3, 50, 3, loot)
    {

    }
}
--- Characters/Monster.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;

public class Monster : Character
{
    public int Level { get; private set; }
    public Item? Loot { get; set; }
    public int ExperienceValue { get; set; }

    public Monster(string name, int health, int strength, int dexterity, int experience, int intellect, Item? loot = null)
        : base(name, health, strength, dexterity, intellect)
    {
        Level = 1;
        ExperienceValue = experience;
        Loot = loot;
    }

    public Monster(Monster other)
        : base(other.Name, other.MaxHealth, other.Stats["Strength"], other.Stats["Dexterity"], other.Stats["Intellect"])
    {
        ExperienceValue = other.ExperienceValue;
        Loot = other.Loot;
        Level = other.Level;
    }

    public Monster Clone()
    {
        return new Monster(this);
    }

    public void ScaleStats(int level)
    {
        Level = level;

        // Get the original base stats from the constructor
        int baseHealth = MaxHealth;
        int baseStrength = Stats["Strength"];
        int baseDexterity = Stats["Dexterity"];
        int baseIntellect = Stats["Intellect"];

        // Apply the scaling formula
        MaxHealth = baseHealth + (level * 5);
        Health = MaxHealth;
        Stats["Strength"] = baseStrength + (level * 2);
        Stats["Dexterity"] = baseDexterity + (level * 1);
        Stats["Intellect"] = baseIntellect + (level * 1);
    }
}
--- Characters/Ogre.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;

public class Ogre : Monster
{
    public Ogre(Item? loot)
        : base("Ogre", 60, 14, 1, 15, 2, loot)
    {

    }
}
--- Characters/Orc.cs ---
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.Characters;
public class Orc : Monster
{
    public Orc(Item? orcLoot)
        : base("Orc", 40, 12, 2, 100, 2, orcLoot)
    {

    }
}
--- Characters/Player.cs ---
using csharp_roguelike_rpg.Abilities;
using csharp_roguelike_rpg.Items;
using csharp_roguelike_rpg.Systems;
using csharp_roguelike_rpg.World;
namespace csharp_roguelike_rpg.Characters;

public class Player : Character
{
    public PlayerClass Class { get; private set; }
    public int Level { get; set; }
    public int Experience { get; set; }
    public int ExperienceToNextLevel { get; set; }
    public Room? CurrentRoom { get; set; }
    public List<Item> Inventory { get; private set; }
    public Dictionary<EquipmentSlot, Item> Equipment { get; private set; }
    public HashSet<Room> VisitedRooms { get; private set; }
    public List<Ability> Abilities { get; private set; }

    public Player(string name, PlayerClass playerClass)
        : base(name, 0, 0, 0, 0)
    {
        Level = 1;
        Experience = 0;
        ExperienceToNextLevel = 100;
        Inventory = new List<Item>();
        Equipment = new Dictionary<EquipmentSlot, Item>();
        VisitedRooms = new HashSet<Room>();
        Abilities = new List<Ability>();

        switch (playerClass)
        {
            case PlayerClass.Warrior:
                MaxHealth = 80;
                MaxEnergy = 10;
                Stats["Strength"] = 12;
                Stats["Dexterity"] = 4;
                Stats["Intellect"] = 3;
                Stats["Lifesteal"] = 0;
                Abilities.Add(new PowerAttack());
                break;
            case PlayerClass.Rogue:
                MaxHealth = 60;
                MaxEnergy = 25;
                Stats["Strength"] = 8;
                Stats["Dexterity"] = 10;
                Stats["Intellect"] = 5;
                Stats["Lifesteal"] = 0;
                Abilities.Add(new DoubleStrike());
                break;
            case PlayerClass.Mage:
                MaxHealth = 50;
                MaxEnergy = 50;
                Stats["Strength"] = 5;
                Stats["Dexterity"] = 6;
                Stats["Intellect"] = 12;
                Stats["Lifesteal"] = 0;
                Abilities.Add(new Fireball());
                break;
        }
        Health = MaxHealth;
        Energy = MaxEnergy;
        Class = playerClass;
    }

    public override int GetTotalStrength()
    {
        int totalStrength = Stats["Strength"];

        // Check for an equipped weapon
        if (Equipment.TryGetValue(EquipmentSlot.MainHand, out Item? equippedItem))
        {
            if (equippedItem is Weapon equippedWeapon)
            {
                // Add weapon's damage
                totalStrength += equippedWeapon.Damage;
            }
        }
        return totalStrength;
    }

    public override int GetTotalDefense()
    {
        int totalDefense = 0;

        // Check for an equipped armor
        if (Equipment.TryGetValue(EquipmentSlot.Chest, out Item? equippedItem))
        {
            if (equippedItem is Armor equippedArmor)
            {
                // Add Armor's defense
                totalDefense += equippedArmor.Defense;
            }
        }
        return totalDefense;
    }

    // In Player.cs
    public void AddExperience(int experienceGained)
    {
        Experience += experienceGained;
        UIManager.SlowPrint($"You gained {experienceGained} experience!");
    }
}
--- DESIGN.md ---
# Game Design Document: C# Fantasy Roguelike

## 1. High-Concept Pitch

* A classic style turn-based fantasy roguelike RPG that focuses on tactical combat and a robust crafting system for character progression and endless replayability.

## 2. Core Gameplay Loop

* **Explore** the dungeon.
* **Encounter** monsters.
* **Fight** in turn-based combat.
* **Collect** loot and crafting materials.
* **Craft** new gear at safe locations.
* **Explore Deeper** into more dangerous levels.
* **Inevitably Die** and learn from the run.
* **Return** to the main menu to start a new, fresh run.

## 3. Key Features

* [x] **Turn-Based Combat System**
  * [x] Stat-based damage (Strength, Defense).
  * [x] Dexterity-based miss chance.
  * [x] Color-coded feedback.
* [x] **Character Stats & Leveling**
  * [x] Experience gain from combat.
  * [x] Stat increases on level-up.
  * [x] `stats` command to view character sheet.
* [x] **Player Inventory & Equipment Slots**
  * [x] `inventory` and `examine` commands.
  * [x] `equip` and `unequip` logic.
  * [x] Dictionary-based equipment slots.
* [x] **Item & Crafting System**
  * [x] Inheritance for item types (`Weapon`, `Armor`, `Potion`).
  * [x] `use` command for consumables.
  * [x] Recipe-based crafting in designated safe areas.

* [X] **Advanced Procedural Generation**
  * [X] Create branching, interconnected dungeons (Improved Drunkard's Walk).
  * [X] Add special room types (e.g., a guaranteed safe Start Room, a Boss Room).
* [ ] **Core Roguelike Loop**
  * [X] A `Game` class to manage the entire session.
  * [X] Game Over screen on player death.
  * [X] A "Play Again?" option that generates a new player and a new dungeon.
  * [ ] Difficulty scaling (Dungeon Floors).
* [X] **Enhanced User Experience**
  * [X] Player Map system to show discovered rooms.
  * [X] Atmospheric pacing with delayed text printing.

## 4. Core Data Models (Class Blueprint)

* **`Game`:** (A new class to manage the entire game session, including the main loop, player state, and dungeon instance.)
* **`Character`:** (Base class for players and monsters.)
* **`Player`:** (Inherits from `Character`.)
* **`Monster`:** (Inherits from `Character`.)
  * **`Goblin`:** (Inherits from `Monster`.)
  * **`Orc`:** (Inherits from `Monster`.)
* **`Item`:** (Base class for all items.)
  * **`Weapon`:** (Inherits from `Item`.)
  * **`Armor`:** (Inherits from `Item`.)
  * **`Potion`:** (Inherits from `Item`.)
* **`CraftingRecipe`:** (Contains required materials and resulting item.)
* **`Room`:** (A single location in the dungeon grid.)
* **`DungeonGenerator`:** (Responsible for creating the `Room` layout.)

## 5. Minimum Viable Product (MVP)

* [x] Player can fight monsters, collect loot, and craft in a post-combat safe area. *(Status: Completed)*

--- GameData.cs ---
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Items;
using csharp_roguelike_rpg.Systems;
using csharp_roguelike_rpg.Abilities;

public class GameData
{
    public Item? StairsDown { get; private set; }
    public List<Item> MasterLootTable { get; private set; }
    public List<Monster> MasterMonsterTable { get; private set; }
    public List<Monster> MasterBossTable { get; private set; }
    public List<CraftingRecipe> AvailableRecipes { get; private set; }
    public Dictionary<PlayerClass, Dictionary<int, List<Modifier>>> ClassTalents { get; private set; }
    public List<Modifier> FountainBlessings { get; private set; }

    public GameData()
    {
        // --- INITIALIZE TABLES ---
        MasterLootTable = new List<Item>();
        MasterMonsterTable = new List<Monster>();
        MasterBossTable = new List<Monster>();
        AvailableRecipes = new List<CraftingRecipe>();
        ClassTalents = new Dictionary<PlayerClass, Dictionary<int, List<Modifier>>>();
        FountainBlessings = new List<Modifier>();

        // --- CRAFTED ITEMS AND MATERIALS ---

        // Materials
        Item goblinHide = new Item("Goblin Hide", "Yuck! What did you do to loot this? leathery and tough but, extremely smelly!");
        Item orcTusk = new Item("Orc Tusk", "surprisingly clean, this Orc flossed!");
        Item boneChips = new Item("Bone Chips", "Probably not useful for soup.");
        Item corrosiveOoze = new Item("Corrosive Ooze", "A vial of bubbling green goo. Don't drink it. Seriously.");
        Item impHeart = new Item("Imp's Heart", "Still warm and faintly glowing. Probably useful in some forbidden recipe, or trash, your call.");
        Item spiderSilk = new Item("Spider Silk", "Strong and sticky. Maybe could be woven into some light armor.");

        // Crafted Items
        Armor leatherArmor = new Armor("Leather Armor", "Simple armor made from goblin hide, you couldn't get the smell off, nasty!. Gves +2 Defense", 2);
        Armor silkArmor = new Armor("Silk Armor", "How did you even weave this yourself? I guess 'cause magic!. Gives +3 Defense", 3);
        Weapon boneSword = new Weapon("Bone Sword", "Looks flimsy, better than nothing, I guess. +2 Damage.", 2);
        Weapon orcTuskSword = new Weapon("Orc Tusk Sword", "Now we are talking, something a little more damaging. +6 Damage.", 6);

        // Weapon drops
        Weapon ogreClub = new Weapon("Ogre's Club", "The only thing they know how to use well. +5 Damage.", 5);
        Weapon dragonClaw = new Weapon("Dragon Claw Dagger", "Nothing says baddass like a DRAGON CLAW for a weapon. Deals 15 damage.", 15);
        Weapon goblinSmasher = new Weapon("Goblin Smasher", "A crudely-named but surprisingly effective mace. Grants +7 Damage.", 7);
        Weapon labyrinthAxe = new Weapon("Labyrinth Axe", "A massive, perfectly balanced axe that smells faintly of bull. Grants +20 Damage.", 20);

        //Armor drops
        Armor noblesRaiment = new Armor("Noble's Raiment", "Impeccably stylish and surprisingly protective. Grants +18 Defense.", 18);
        Armor trollsHideArmor = new Armor("Troll-Hide Armor", "Thick, pungent, and still slightly regenerating. Grants +10 Defense.", 10);

        //Relics
        Relic lichsPhylactery = new Relic("Lich's Phylactery", "A glowing gem that pulses with stolen life force.", new StatModifier("Lifesteal", "Your attacks now heal you for a small amount.", Rarity.Epic, "Lifesteal", 2, "null", 0));
        Relic heartOfTheInferno = new Relic("Heart of the Inferno", "The still-burning heart of a dragon. You feel its power.", new AbilityGrantModifier("Dragon's Breath", "Grants the powerful Fireball ability.", Rarity.Unique, new Fireball()));

        // --- SPECIAL ITEMS ---
        Item StairsDown = new Item("Stairs Down", "A staircase leading deeper into the darkness...");


        //----------------------------------------------------------------------------------------------------------------------------------------------
        // --- TABLE CONTENTS ---
        //----------------------------------------------------------------------------------------------------------------------------------------------        

        // --- MASTER LOOT TABLE ---
        MasterLootTable.Add(new Armor("Rusty Armor", "Well, better than nothing!", 2));
        MasterLootTable.Add(new Weapon("Rusty Sword", "An old sword, as sharp as rolling pin!. At least it could give Tetanus", 2));
        MasterLootTable.Add(new Potion("Small Potion", "Wouldn't hurt to drink this, wouldn't help either (Restores 20 health, impressive...)", 20));
        MasterLootTable.Add(goblinHide);
        MasterLootTable.Add(orcTusk);


        // --- MASTER MONSTER TABLE ---
        MasterMonsterTable.Add(new Goblin(goblinHide));
        MasterMonsterTable.Add(new Orc(orcTusk));
        MasterMonsterTable.Add(new GiantSpider(spiderSilk));
        MasterMonsterTable.Add(new AnimatedSkeleton(boneChips));
        MasterMonsterTable.Add(new CorrosiveSlime(corrosiveOoze));
        MasterMonsterTable.Add(new FireImp(impHeart));
        MasterMonsterTable.Add(new Ogre(ogreClub));


        // --- MASTER BOSS TABLE ---
        MasterBossTable.Add(new BossGoblinKing(goblinSmasher)); // Level 1 Boss
        MasterBossTable.Add(new BossTrollChieftain(trollsHideArmor)); // Level 2 Boss
        MasterBossTable.Add(new BossLichLord(lichsPhylactery)); // Level 3 Boss
        MasterBossTable.Add(new BossMinotaurGuardian(labyrinthAxe)); // Level 4 Boss     
        MasterBossTable.Add(new BossVampCount(noblesRaiment)); // Level 5 Boss
        MasterBossTable.Add(new Boss(dragonClaw)); // Final Boss


        // --- CRAFTING TABLE ---
        CraftingRecipe armorRecipe = new CraftingRecipe(leatherArmor, new Dictionary<Item, int>
        {
            { goblinHide, 2 }
        });
        AvailableRecipes.Add(armorRecipe);

        // --- FOUNTAIN BLESSINGS ---
        FountainBlessings.Add(new StatModifier("Blessing of Strength", "You feel a surge of power! +2 Strength", Rarity.Heroic, "Strength", 2, "null", 0));
        FountainBlessings.Add(new StatModifier("Blessing of Agility", "You feel lighter on your feet! +2 Dexterity", Rarity.Heroic, "Dexterity", 2, "null", 0));
        FountainBlessings.Add(new StatModifier("Blessing of Intellect", "Your mind feels clearer! +2 Intellect", Rarity.Heroic, "Intellect", 2, "null", 0));

        //----------------------------------------------------------------------------------------------------------------------------------------------
        // --- TALENTS ---
        //----------------------------------------------------------------------------------------------------------------------------------------------

        // --- WARRIOR TALENTS ---
        ClassTalents[PlayerClass.Warrior] = new Dictionary<int, List<Modifier>>
        {
            // Level 3 Talents
            [3] = new List<Modifier>
        {
            new StatModifier("Thick Hide", "Who needs brains when you have brawn? and you have neither. Permanently increases Max Health by 15.", Rarity.Uncommon, "MaxHealth", 15, "null",  0),
            new StatModifier("Weapon Master", "You smash things harder now, woop!. Permanently increases Strength by 2.", Rarity.Uncommon, "Strength", 2, "null", 0),
            new StatModifier("Adrenaline Rush", "You feel less pain now, big deal. Permanently increases Dexterity by 1.", Rarity.Common, "Dexterity", 1, "null", 0)
        },
            // Level 6 Talents
            [6] = new List<Modifier>
        {
            new StatModifier("Juggernaut", "Moar brawn, but this time, less brains. Permanently increases Max Health by 20 and reduces Intellect by 5.", Rarity.Uncommon, "MaxHealth", 20, "Intellect", 5),
            new StatModifier("Berserker", "Who needs full health when you can go faster?. Permanently increases Dexterity by 2.", Rarity.Uncommon, "Dexterity", 2, "null", 0),
            new StatModifier("Mighty Blow", "ME BIG STRONG, HIT THINGS HARDER!. Permanently increases Strength by 3.", Rarity.Epic, "Strength", 3, "null", 0)
        },
            // Level 9 Talents
            [9] = new List<Modifier>
        {
            new StatModifier("Unstoppable", "You just won't die, won't you?. Permanently increases Max Health by 25.", Rarity.Epic, "MaxHealth", 25, "null", 0),
            new StatModifier("Whirlwind", "Fan goes hurr durr. Permanently increases Dexterity by 3.", Rarity.Epic, "Dexterity", 3, "null", 0),
            new StatModifier("Colossal Strength", "ME DA STRONGEST, NOT THE INTELLIGENTEST. Permanently increases Strength by 10, Intellect reduced by 2.", Rarity.Legendary, "Strength", 4, "Intellect", 2)
        }
        };

        // --- ROGUE TALENTS ---
        ClassTalents[PlayerClass.Rogue] = new Dictionary<int, List<Modifier>>
        {
            // Level 3 Talents
            [3] = new List<Modifier>
        {
            new StatModifier("Fleet Footed", "I AM SPEED!. Permanently increases Dexterity by 2.", Rarity.Uncommon, "Dexterity", 2, "null", 0),
            new StatModifier("Precise Strikes", "Your stab got stabbier!. Permanently increases Strength by 1.", Rarity.Common, "Strength", 1, "null", 0),
            new StatModifier("Toughness", "You are not as feeble as I thought. Permanently increases Max Health by 10.", Rarity.Common, "MaxHealth", 10, "null", 0)
        },
            // Level 6 Talents
            [6] = new List<Modifier>
            {
            new StatModifier("Evasion", "You can't C me!. Permanently increases Dexterity by 3.", Rarity.Uncommon, "Dexterity", 3, "null", 0),
            new StatModifier("Killer Instinct", "Kill all the things!. Permanently increases Strength by 2.", Rarity.Uncommon, "Strength", 2, "null", 0),
            new StatModifier("Iron Will", "Really, you are going for a tanky build? whatever!. Permanently increases Max Health by 15.", Rarity.Common, "MaxHealth", 15, "null", 0)
            },
            // Level 9 Talents
            [9] = new List<Modifier>
            {
            new StatModifier("Shadowstep", "Sneaky stabby!. Permanently increases Dexterity by 4.", Rarity.Epic, "Dexterity", 4, "null", 0),
            new StatModifier("Assassinate", "Kill kill kill. Permanently increases Strength by 3.", Rarity.Epic, "Strength", 3, "null", 0),
            new StatModifier("Stone Skin", "Why do you even pick me?. Permanently increases Max Health by 20.", Rarity.Epic, "MaxHealth", 20, "null", 0)
            }
        };

        // --- MAGE TALENTS ---
        ClassTalents[PlayerClass.Mage] = new Dictionary<int, List<Modifier>>
        {
            // Level 3 Talents for Mage
            [3] = new List<Modifier>
        {
            new StatModifier("Arcane Intellect", "You are smarter than a fifth grader!. Permanently increases Intellect by 3.", Rarity.Uncommon, "Intellect", 3, "null", 0),
            new StatModifier("Glass Cannon", "Do I really need to explain this?. +5 Intellect, -5 Max Health.", Rarity.Epic, "Intellect", 5, "MaxHealth", 5),
            new StatModifier("Stamina", "Basic white mage buff. Permanently increases Max Health by 12.", Rarity.Common, "MaxHealth", 12, "null", 0)
        },
            // Level 6 Talents for Mage
            [6] = new List<Modifier>
        {
            new StatModifier("Elemental Mastery", "You are even smarter than a fifth grader!. Permanently increases Intellect by 5.", Rarity.Epic, "Intellect", 5, "null", 0),
            new StatModifier("Mana Fountain", "You can cast more fireballs, how original!. Permanently increases Max Energy by 20.", Rarity.Uncommon, "MaxEnergy", 20, "null", 0),
            new StatModifier("Quick Thinking", "You are quick as a magical fox. Permanently increases Dexterity by 2.", Rarity.Uncommon, "Dexterity", 2, "null", 0)
        },
            // Level 9 Talents for Mage
            [9] = new List<Modifier>
        {
            new StatModifier("Archmage", "You are the smartest fifth grader ever!. Permanently increases Intellect by 5.", Rarity.Legendary, "Intellect", 5, "null", 0),
            new StatModifier("Manaforged", "Your magical reserves are unlimited!, not really. Permanently increases Max Energy by 25.", Rarity.Epic, "MaxEnergy", 25, "null", 0),
            new StatModifier("Glassier Cannon", "all brains and no brawn. Permanently increases Intellect by 10, decreases health by 10.", Rarity.Epic, "Intellect", 10, "MaxHealth", 10)
        }
        };
    }
}
--- Items/Armor.cs ---
namespace csharp_roguelike_rpg.Items;
public class Armor : Item
{
    public int Defense { get; set; }

    public Armor(string name, string description, int defense) : base(name, description)
    {
        Defense = defense;
    }
}
--- Items/CraftingRecipe.cs ---
namespace csharp_roguelike_rpg.Items;
public class CraftingRecipe
{
    // Key is the item, the value is the required quantity
    public Dictionary<Item, int> RequiredMaterials { get; private set; }
    public Item ResultingItem { get; private set; }

    public CraftingRecipe(Item result, Dictionary<Item, int> materials)
    {
        ResultingItem = result;
        RequiredMaterials = materials;
    }
}
--- Items/Item.cs ---
namespace csharp_roguelike_rpg.Items;
public class Item
{
    public string Name { get; set; }
    public string Description { get; set; }

    public Item(string name, string description)
    {
        Name = name;
        Description = description;
    }
}
--- Items/Potion.cs ---
namespace csharp_roguelike_rpg.Items;
public class Potion : Item
{
    public int HealthToRestore { get; set; }

    public Potion(string name, string description, int healthToRestore) : base(name, description)
    {
        HealthToRestore = healthToRestore;
    }
}
--- Items/Relic.cs ---
using csharp_roguelike_rpg.Systems;
namespace csharp_roguelike_rpg.Items;

public class Relic : Item
{
    public Modifier Effect { get; private set; }

    public Relic(string name, string description, Modifier effect) : base(name, description)
    {
        Effect = effect;
    }
}
--- Items/Weapon.cs ---
namespace csharp_roguelike_rpg.Items;
public class Weapon : Item
{
    public int Damage { get; set; }

    public Weapon(string name, string description, int damage) : base(name, description)
    {
        Damage = damage;
    }
}
--- Program.cs ---
ï»¿
using csharp_roguelike_rpg.Systems;

Game game = new Game();
game.Run();
--- README.md ---
# C# Procedural Roguelike RPG

A classic, turn-based fantasy roguelike built from the ground up in C#. This project focuses on demonstrating core game systems design, object-oriented principles, and procedural content generation, all within a polished console application.

## Key Features

* **Infinite Dungeons:** Explore a new, unique dungeon on every playthrough, procedurally generated using a "Drunkard's Walk" algorithm.
* **Tactical Turn-Based Combat:** Engage in classic RPG combat with mechanics for attacking, missing, and damage reduction based on stats and gear.
* **Character Progression:** Gain experience from defeating monsters to level up, increasing your stats and becoming more powerful.
* **Equipment System:** Find, equip, and manage `Weapons` and `Armor` in distinct equipment slots. Gear directly impacts combat performance.
* **Consumables & Crafting:** Use `Potions` to heal and gather materials from monsters to `craft` new items.

## Technical Deep Dive

This project was built to showcase a strong understanding of C# and core software engineering principles.

* **Architecture (OOP):** The project is built on a strong object-oriented foundation. A multi-layer inheritance hierarchy (`Character` -> `Monster` -> `Goblin`/`Orc`) is used to model game entities, promoting code reuse and scalability. Game logic is encapsulated into distinct classes (`DungeonGenerator`) and helper methods (`StartCombat`, `MovePlayer`) to follow the Single Responsibility Principle.

* **Procedural Generation:** The world is generated using a "Drunkard's Walk" algorithm. A `Dictionary<string, Room>` serves as a flexible and efficient sparse grid to store the map data, allowing for complex and non-rectangular dungeon layouts.

* **Game Systems Design:**
  * **Combat:** The turn-based combat system uses character stats (`Strength`, `Dexterity`) and equipped item properties (`Damage`, `Defense`) to calculate outcomes, including a miss chance based on a simulated "to-hit" roll.
  * **Items & Inheritance:** The item system uses inheritance (`Item` -> `Weapon`/`Armor`/`Potion`) and C#'s `is` keyword for type-checking, allowing for different item types with unique properties and behaviors (`equip` vs. `use`).
  * **State Management:** The main game loop is a state machine that cleanly transitions between exploration, combat, and crafting phases.

## How to Run

1. Clone the repository.
2. Navigate to the project directory.
3. Run the application with `dotnet run`.

--- Systems/AbilityGrantModifier.cs ---
namespace csharp_roguelike_rpg.Systems;
using csharp_roguelike_rpg.Abilities;
using csharp_roguelike_rpg.Characters;

public class AbilityGrantModifier : Modifier
{
    private readonly Ability _abilityToGrant;

    public AbilityGrantModifier(string name, string description, Rarity rarity, Ability abilityToGrant)
    {
        Name = name;
        Description = description;
        Rarity = rarity;
        _abilityToGrant = abilityToGrant;
    }

    public override void Apply(Player player)
    {
        player.Abilities.Add(_abilityToGrant);
        UIManager.SlowPrint($"You have learned a new ability: {_abilityToGrant.Name}!", ConsoleColor.Magenta);
        UIManager.SlowPrint($"{_abilityToGrant.Description}", ConsoleColor.Magenta);
    }
}
--- Systems/CombatResult.cs ---
namespace csharp_roguelike_rpg.Systems;

public enum CombatResult
{
    InProgress,
    PlayerVictory,
    PlayerDefeat,
    PlayerVictoryAndGameWon,
    PlayerFled // Backlog implementation
}
--- Systems/EquipmentSlot.cs ---
namespace csharp_roguelike_rpg.Systems;
public enum EquipmentSlot
{
    MainHand,
    Chest
}
--- Systems/Game.cs ---
namespace csharp_roguelike_rpg.Systems;

using System.Net.Quic;
using csharp_roguelike_rpg.Abilities;
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Items;
using csharp_roguelike_rpg.World;

public class Game
{
    // --- FIELDS ---
    private Player _player = null!;
    private DungeonGenerator _generator;
    private GameData _gameData;
    private int _currentFloor;
    private Random _random;

    public Game()
    {
        _gameData = new GameData();
        _generator = new DungeonGenerator(_gameData);
        _random = new Random();
    }

    private void SetupNewGame()
    {
        _currentFloor = 1;
        Console.Clear();
        UIManager.SlowPrint("WELCOME TO YOUR DOOM!");

        string? playerName;
        do
        {
            UIManager.SlowPrint("What is your name, fool?");
            Console.Write("> ");
            playerName = Console.ReadLine();
        } while (string.IsNullOrWhiteSpace(playerName));

        UIManager.SlowPrint("Choose your weakling:");
        UIManager.SlowPrint("1. Warrior (High Health, High Strength)");
        UIManager.SlowPrint("2. Rogue   (High Dexterity, Balanced)");
        UIManager.SlowPrint("3. Mage    (Low Health, High Potential)");

        PlayerClass chosenClass;
        while (true)
        {
            Console.Write("> ");
            string? input = Console.ReadLine();
            if (input == "1" || input?.ToLower() == "warrior")
            {
                chosenClass = PlayerClass.Warrior;
                break;
            }
            if (input == "2" || input?.ToLower() == "rogue")
            {
                chosenClass = PlayerClass.Rogue;
                break;
            }
            if (input == "3" || input?.ToLower() == "mage")
            {
                chosenClass = PlayerClass.Mage;
                break;
            }
            Console.WriteLine("Invalid choice. Please enter 1, 2, or 3.");
        }
        UIManager.SlowPrint($"So, you will be playing the {chosenClass}? Good luck, you'll need it...");

        // --- WORLD AND PLAYER CREATION ---
        Room startingRoom = _generator.Generate(10, _currentFloor);
        _player = new Player(playerName, chosenClass);
        _player.CurrentRoom = startingRoom;
        _player.VisitedRooms.Add(startingRoom);
    }

    private void SetupNextFloor()
    {
        _currentFloor++;
        UIManager.SlowPrint($"You descend to floor {_currentFloor}...", ConsoleColor.Magenta);

        // Re-generate the world for the new floor
        Room startingRoom = _generator.Generate(10, _currentFloor);
        _player.CurrentRoom = startingRoom;
        _player.VisitedRooms.Clear(); // Clear the map for the new floor
        _player.VisitedRooms.Add(startingRoom);
    }

    private void HandlePlayerDeath()
    {
        UIManager.SlowPrint("\nYou have fallen in the dark...", ConsoleColor.Red);
        UIManager.SlowPrint("Your adventure ends here.", ConsoleColor.Red);
    }


    private bool GameLoop()
    {
        while (true)
        {
            Console.Write("\n> ");
            string? choice = Console.ReadLine();

            if (string.IsNullOrEmpty(choice))
            {
                UIManager.SlowPrint("Please enter a command.");
                continue;
            }

            // Split the input into words to get the command verb
            string[] words = choice.ToLower().Split(' ');
            string verb = words[0];

            // The new command parser
            switch (verb)
            {
                case "north":
                case "south":
                case "east":
                case "west":
                    if (_player.CurrentRoom != null)
                    {
                        CombatResult combatResult = CombatResult.PlayerVictory;
                        switch (verb)
                        {
                            case "north":
                                combatResult = MovePlayer(_player.CurrentRoom.North);
                                break;
                            case "south":
                                combatResult = MovePlayer(_player.CurrentRoom.South);
                                break;
                            case "east":
                                combatResult = MovePlayer(_player.CurrentRoom.East);
                                break;
                            case "west":
                                combatResult = MovePlayer(_player.CurrentRoom.West);
                                break;
                        }
                        if (combatResult == CombatResult.PlayerDefeat || combatResult == CombatResult.PlayerVictoryAndGameWon)
                        {
                            return false; // Exit GameLoop if player died or won
                        }
                    }
                    break;

                case "look":
                case "l":
                    DescribeRoom();
                    break;

                case "stats":
                case "char":
                    Console.WriteLine("\n--- Character Stats ---");
                    Console.WriteLine($" Name: {_player.Name}");
                    Console.WriteLine($" Class: {_player.Class}");
                    Console.WriteLine($" Level: {_player.Level}");
                    Console.WriteLine($" Experience: {_player.Experience} / {_player.ExperienceToNextLevel}");
                    Console.WriteLine($" Health: {_player.Health} / {_player.MaxHealth}");
                    Console.WriteLine($" Energy: {_player.Energy} / {_player.MaxEnergy}");
                    Console.WriteLine("-----------------------");
                    Console.WriteLine(" Attributes:");
                    foreach (var stat in _player.Stats)
                    {
                        Console.WriteLine($" - {stat.Key}: {stat.Value}");
                    }
                    Console.WriteLine(" Abilities:");
                    foreach (var ability in _player.Abilities)
                    {
                        Console.WriteLine($" - {ability.Name}(Cost: {ability.EnergyCost}): {ability.Description}");
                    }
                    Console.WriteLine("-----------------------");
                    break;

                case "map":
                case "m":
                    DrawMap();
                    break;

                case "inventory":
                case "i":
                    // display player inventory
                    if (_player.Inventory.Any())
                    {
                        Console.WriteLine("\nInventory");
                        foreach (var item in _player.Inventory)
                        {
                            Console.WriteLine($"- {item.Name}");
                        }
                    }
                    else
                    {
                        Console.WriteLine("\nYour inventory is empty");
                    }
                    break;

                case "examine":
                case "x":
                    if (words.Length > 1)
                    {
                        string itemToExamineName = string.Join(" ", words.Skip(1));
                        Item? itemToExamine = _player.Inventory.Find(item => item.Name.Equals(itemToExamineName, StringComparison.OrdinalIgnoreCase));

                        if (itemToExamine != null)
                        {
                            Console.WriteLine($"\n{itemToExamine.Name}");
                            UIManager.SlowPrint($"  {itemToExamine.Description}");
                        }
                        else
                        {
                            Console.WriteLine($"You don't have a '{itemToExamineName}' in your inventory.");
                        }
                    }
                    else
                    {
                        Console.WriteLine("What do you want to examine?");
                    }
                    break;

                case "take":
                    if (_player.CurrentRoom == null)
                    {
                        Console.WriteLine("Did you write anything?");
                        break;
                    }
                    if (words.Length > 1)
                    {
                        string itemToTakeName = string.Join(" ", words.Skip(1));
                        Item? itemToTake = _player.CurrentRoom.ItemsInRoom.Find(item => item.Name.Equals(itemToTakeName, StringComparison.OrdinalIgnoreCase));

                        if (itemToTake != null)
                        {
                            _player.Inventory.Add(itemToTake);
                            Console.WriteLine($"You took the {itemToTake.Name}");
                            _player.CurrentRoom.ItemsInRoom.Remove(itemToTake);
                        }
                    }
                    break;

                case "drop":
                    if (_player.CurrentRoom == null)
                    {
                        Console.WriteLine("STOP TRYING TO BREAK MY GAME! =(");
                        break;
                    }
                    if (words.Length > 1)
                    {
                        string itemToDropName = string.Join(" ", words.Skip(1));
                        Item? itemToDrop = _player.Inventory.Find(item => item.Name.Equals(itemToDropName, StringComparison.OrdinalIgnoreCase));

                        if (itemToDrop != null)
                        {
                            _player.Inventory.Remove(itemToDrop);
                            Console.WriteLine($"You dropped the {itemToDrop.Name}");
                            _player.CurrentRoom.ItemsInRoom.Add(itemToDrop);
                        }
                    }
                    break;

                case "equip":
                    if (words.Length > 1)
                    {
                        string itemToEquipName = string.Join(" ", words.Skip(1));

                        Item? itemToEquip = _player.Inventory.Find(item => item.Name.Equals(itemToEquipName, StringComparison.OrdinalIgnoreCase));

                        // Find if the item is in the Inventory
                        if (itemToEquip == null)
                        {
                            Console.WriteLine("You don't have that item in your inventory.");
                            break;
                        }
                        // If item is a Weapon
                        if (itemToEquip is Weapon weapon)
                        {
                            // Unequip any equipped item in the slot
                            if (_player.Equipment.ContainsKey(EquipmentSlot.MainHand))
                            {
                                _player.Inventory.Add(_player.Equipment[EquipmentSlot.MainHand]);
                                Console.WriteLine($"You unequip {_player.Equipment[EquipmentSlot.MainHand].Name}.");
                            }

                            // Equip the new weapon
                            _player.Equipment[EquipmentSlot.MainHand] = weapon;
                            _player.Inventory.Remove(weapon); // This line removes it from the inventory
                            Console.WriteLine($"You equip the {weapon.Name}.");
                        }
                        // If item is Armor
                        else if (itemToEquip is Armor armor)
                        {
                            // Unequip any equipped item in the slot
                            if (_player.Equipment.ContainsKey(EquipmentSlot.Chest))
                            {
                                _player.Inventory.Add(_player.Equipment[EquipmentSlot.Chest]);
                                Console.WriteLine($"You unequip {_player.Equipment[EquipmentSlot.Chest].Name}.");
                            }

                            // Equip the new armor
                            _player.Equipment[EquipmentSlot.Chest] = armor;
                            _player.Inventory.Remove(armor); // This line removes it from the inventory
                            Console.WriteLine($"You equip the {armor.Name}.");
                        }
                        else
                        {
                            // The item is not equippable.
                            Console.WriteLine("You can't equip that type of item.");
                        }
                    }
                    else
                    {
                        Console.WriteLine("What do you want to equip?");
                    }
                    break;
                case "use":
                    if (words.Length > 1)
                    {
                        string itemToUseName = string.Join(" ", words.Skip(1));

                        Item? itemToUse = _player.Inventory.Find(item => item.Name.Equals(itemToUseName, StringComparison.OrdinalIgnoreCase));

                        if (itemToUse == null)
                        {
                            Console.WriteLine("You don't have that item in your inventory.");
                            break;
                        }
                        if (itemToUse is Potion potion)
                        {
                            _player.Health += potion.HealthToRestore;
                            if (_player.Health > _player.MaxHealth)
                            {
                                _player.Health = _player.MaxHealth; // Cap health at max health
                            }
                            _player.Inventory.Remove(potion);
                            UIManager.SlowPrint($"You use the {potion.Name} and restore {potion.HealthToRestore} health. You now have {_player.Health}/{_player.MaxHealth} HP", ConsoleColor.Green);
                        }
                        else
                        {
                            Console.WriteLine("You can't use that item.");
                        }
                    }
                    else
                    {
                        Console.WriteLine("What do you want to use?");
                    }
                    break;
                case "craft":
                    // First, check if the room is safe (no monsters).
                    if (_player.CurrentRoom != null && _player.CurrentRoom.MonstersInRoom.Any())
                    {
                        UIManager.SlowPrint("It's too dangerous to craft here!", ConsoleColor.Red);
                        break;
                    }

                    // --- Enter the Crafting Sub-Menu ---
                    UIManager.SlowPrint("You approach a quiet corner and lay out your materials...", ConsoleColor.DarkGray);
                    while (true)
                    {
                        Console.WriteLine("\n--- Crafting Menu ---");
                        if (_gameData.AvailableRecipes.Any())
                        {
                            Console.WriteLine("Available recipes:");
                            foreach (var recipe in _gameData.AvailableRecipes)
                            {
                                Console.WriteLine($"- craft {recipe.ResultingItem.Name.ToLower()}");
                            }
                        }
                        else
                        {
                            Console.WriteLine("You don't know any recipes.");
                        }
                        Console.WriteLine("- i (view inventory)");
                        Console.WriteLine("- leave");
                        Console.Write("> ");
                        string? craftingChoice = Console.ReadLine();

                        if (string.IsNullOrEmpty(craftingChoice)) continue;

                        if (craftingChoice.Equals("leave", StringComparison.OrdinalIgnoreCase))
                        {
                            UIManager.SlowPrint("You pack up your materials.");
                            break; // Exit the crafting loop
                        }
                        else if (craftingChoice.Equals("i", StringComparison.OrdinalIgnoreCase) || craftingChoice.Equals("inventory", StringComparison.OrdinalIgnoreCase))
                        {
                            if (_player.Inventory.Any())
                            {
                                Console.WriteLine("\nInventory");
                                foreach (var item in _player.Inventory)
                                {
                                    Console.WriteLine($"- {item.Name}");
                                }
                            }
                            else
                            {
                                Console.WriteLine("\nYour inventory is empty");
                            }
                        }
                        else if (craftingChoice.StartsWith("craft ", StringComparison.OrdinalIgnoreCase))
                        {
                            string itemToCraftName = craftingChoice.Substring(6);

                            CraftingRecipe? recipe = _gameData.AvailableRecipes.Find(r => r.ResultingItem.Name.Equals(itemToCraftName, StringComparison.OrdinalIgnoreCase));

                            if (recipe == null)
                            {
                                Console.WriteLine("You don't know how to craft that.");
                                continue;
                            }

                            bool canCraft = true;
                            foreach (var material in recipe.RequiredMaterials)
                            {
                                int materialCount = _player.Inventory.Count(item => item.Name == material.Key.Name);
                                if (materialCount < material.Value)
                                {
                                    Console.WriteLine($"You don't have enough {material.Key.Name}. Required: {material.Value}, Have: {materialCount}");
                                    canCraft = false;
                                    break;
                                }
                            }

                            if (canCraft)
                            {
                                foreach (var material in recipe.RequiredMaterials)
                                {
                                    for (int i = 0; i < material.Value; i++)
                                    {
                                        Item itemToRemove = _player.Inventory.First(item => item.Name == material.Key.Name);
                                        _player.Inventory.Remove(itemToRemove);
                                    }
                                }
                                _player.Inventory.Add(recipe.ResultingItem);
                                UIManager.SlowPrint($"Successfully crafted {recipe.ResultingItem.Name}!", ConsoleColor.Green);
                            }
                        }
                    }
                    break;
                case "descend":
                case "down":
                    if (_gameData.StairsDown != null &&
                        _player.CurrentRoom != null &&
                        _player.CurrentRoom.ItemsInRoom.Contains(_gameData.StairsDown))
                    {
                        return true;
                    }
                    else
                    {
                        UIManager.SlowPrint("There is nowhere to descend to here.");
                    }
                    break;
                case "drink":
                    // Check if the player is in a Fountain Room
                    if (_player.CurrentRoom?.Name != "Fountain Room")
                    {
                        UIManager.SlowPrint("There is nothing to drink here.");
                        break;
                    }
                    // Get two random blessings from the Blessings table
                    var blessings = _gameData.FountainBlessings.OrderBy(x => _random.Next()).Take(2).ToList();

                    UIManager.SlowPrint("You approach the glowing fountain. What do you do?", ConsoleColor.Cyan);
                    Console.WriteLine($"1. {blessings[0].Description}");
                    Console.WriteLine($"2. {blessings[1].Description}");
                    Console.WriteLine("3. Drink deeply to restore your health.");

                    // Process player choices and apply appropriate blessing or full heal
                    while (true)
                    {
                        Console.Write("> ");
                        string? input = Console.ReadLine();
                        if (input == "1")
                        {
                            blessings[0].Apply(_player);
                            break;
                        }
                        if (input == "2")
                        {
                            blessings[1].Apply(_player);
                            break;
                        }
                        if (input == "3")
                        {
                            _player.Health = _player.MaxHealth;
                            UIManager.SlowPrint("The water invigorates you, restoring your health to full!", ConsoleColor.Green);
                            break;
                        }
                        Console.WriteLine("Invalid choice.");
                    }

                    // Fountain is meant to be used once, make inert after use
                    _player.CurrentRoom.Name = "Inert Fountain Room";
                    _player.CurrentRoom.Description = "The fountain's glow has faded, its magic spent.";
                    break;
                case "quit":
                    UIManager.SlowPrint("You decide to rest for now. Until next time!");
                    return false;

                default:
                    Console.WriteLine("I don't understand that command.");
                    break;
            }
        }
    }
    public void Run()
    {
        // The master "Play Again?" loop
        while (true)
        {
            SetupNewGame(); // Creates a new character on floor 1

            // The "Dungeon Floor" loop for a single run
            bool playerIsAlive = true;
            while (playerIsAlive)
            {
                DescribeRoom();
                bool shouldDescend = GameLoop();

                if (shouldDescend) // Player wants to descend
                {
                    _currentFloor++;
                    SetupNextFloor();
                }
                else // Player quit, died, or won the game
                {
                    playerIsAlive = false; // Exit the floor loop
                }

                // --- AFTER RUN IS OVER ---
                if (_player.Health <= 0)
                {
                    HandlePlayerDeath();
                }

                UIManager.SlowPrint("\nPlay Again? (y/n)");
                string? playAgain = Console.ReadLine();
                if (playAgain?.ToLower() != "y")
                {
                    break; // Exit the master "Play Again?" loop
                }
            }
            UIManager.SlowPrint("Thanks for playing!");
        }
    }

    //----------------------------------------------------------------------------------------------------------
    //----------------------------------------------------------------------------------------------------------

    // --- HELPER METHODS ---

    private CombatResult StartCombat(Monster monsterToFight)
    {
        Random random = new Random();

        UIManager.SlowPrint($"{_player.Name} encounters a fierce {monsterToFight.Name}");

        UIManager.SlowPrint("Rolling for initiave... feeling lucky?");
        var combatants = new List<Character> { _player, monsterToFight };
        var turnOrder = combatants.OrderByDescending(c => c.Stats["Dexterity"] + random.Next(1, 21)).ToList();
        UIManager.SlowPrint("Turn order is set!");
        foreach (var character in turnOrder)
        {
            UIManager.SlowPrint($"- {character.Name}", ConsoleColor.DarkGray);
        }



        // Turn-Based combat
        int round = 1;
        while (_player.Health > 0 && monsterToFight.Health > 0)
        {
            // Display Status
            Console.WriteLine("\n--------------------");
            Console.WriteLine($"{_player.Name}: {_player.Health}/{_player.MaxHealth}");
            Console.WriteLine($"Energy {_player.Energy}/{_player.MaxEnergy}");
            Console.WriteLine(" ");
            Console.WriteLine($"{monsterToFight.Name}: {monsterToFight.Health}/{monsterToFight.MaxHealth}");
            Console.WriteLine($"Energy: {monsterToFight.Energy}/{monsterToFight.MaxEnergy}");
            Console.WriteLine("\n--------------------");

            Console.WriteLine($"\n--- ROUND {round} ---");

            foreach (var character in turnOrder)
            {
                character.IsDefending = false;

                if (character.Health <= 0) continue;
                if (_player.Health <= 0 || monsterToFight.Health <= 0) break;

                if (character is Player)
                {
                    _player.Energy += 5;
                    if (_player.Energy == _player.MaxEnergy)
                    {
                        _player.Energy = _player.MaxEnergy;
                    }
                    UIManager.SlowPrint("Your turn! Choose an action");
                    Console.WriteLine("- attack");
                    Console.WriteLine("- defend");
                    foreach (var ability in _player.Abilities)
                    {
                        Console.WriteLine($"- {ability.Name?.ToLower()} (Cost: {ability.EnergyCost})");
                    }
                    Console.Write("> ");
                    string? playerChoice = Console.ReadLine();

                    // Safety check to prevent passing null values
                    if (string.IsNullOrEmpty(playerChoice))
                    {
                        Console.WriteLine("You must enter a command!");
                        continue; // Skip the rest of the turn
                    }

                    // Process Player's Action
                    if (playerChoice.Equals("attack", StringComparison.OrdinalIgnoreCase))
                    {
                        int attackRoll = random.Next(1, 21) + _player.Stats["Dexterity"];
                        int evasionClass = 10 + monsterToFight.Stats["Dexterity"];

                        if (attackRoll >= evasionClass)
                        {
                            // Calculate damage based on player strength and weapon
                            int damageDealt = _player.GetTotalStrength();
                            monsterToFight.Health -= damageDealt;
                            UIManager.SlowPrint($"You attack the {monsterToFight.Name}, dealing {damageDealt} damage!", ConsoleColor.Cyan);

                            // Apply lifesteal if applicable
                            if (_player.Stats["Lifesteal"] > 0)
                            {
                                int lifestealAmount = _player.Stats["Lifesteal"] * damageDealt / 100;
                                _player.Health += lifestealAmount;
                                if (_player.Health > _player.MaxHealth)
                                {
                                    _player.Health = _player.MaxHealth; // Cap health at max health
                                }
                                UIManager.SlowPrint($"You steal {lifestealAmount} health from the {monsterToFight.Name}!", ConsoleColor.Green);
                            }
                        }
                        else
                        {
                            UIManager.SlowPrint("You swing and miss!", ConsoleColor.Gray);
                        }
                    }
                    else if (playerChoice.Equals("defend", StringComparison.OrdinalIgnoreCase))
                    {
                        _player.IsDefending = true;
                        UIManager.SlowPrint($"{_player.Name} takes a defensive stance!", ConsoleColor.White);
                    }
                    else
                    {
                        Ability? chosenAbility = _player.Abilities.Find(a => a.Name?.Equals(playerChoice, StringComparison.OrdinalIgnoreCase) ?? false);
                        if (chosenAbility != null)
                        {
                            if (_player.Energy >= chosenAbility.EnergyCost)
                            {
                                chosenAbility.Use(_player, monsterToFight);
                                _player.Energy -= chosenAbility.EnergyCost;
                            }
                            else
                            {
                                UIManager.SlowPrint("Fool, you do not have anough energy, can't you read?");
                            }
                        }
                        else
                        {
                            UIManager.SlowPrint("Invalid command! You hesitate and lose your turn.");
                        }
                    }
                    Console.WriteLine("\n--------------------");
                    Console.WriteLine($"{_player.Name}: {_player.Health}/{_player.MaxHealth}");
                    Console.WriteLine($"Energy {_player.Energy}/{_player.MaxEnergy}");
                    Console.WriteLine(" ");
                    Console.WriteLine($"{monsterToFight.Name}: {monsterToFight.Health}/{monsterToFight.MaxHealth}");
                    Console.WriteLine($"Energy: {monsterToFight.Energy}/{monsterToFight.MaxEnergy}");
                    Console.WriteLine("\n--------------------");
                }

                else if (character is Monster actingMonster)
                {
                    // --- NEW TO-HIT LOGIC FOR MONSTER ---
                    int attackRoll = random.Next(1, 21) + actingMonster.Stats["Dexterity"];
                    int evasionClass = 10 + _player.Stats["Dexterity"];

                    if (attackRoll >= evasionClass)
                    {
                        // It's a hit!
                        int monsterDamage = actingMonster.Stats["Strength"];
                        int playerDefense = _player.GetTotalDefense();
                        int damageToPlayer = monsterDamage - playerDefense;

                        if (_player.IsDefending)
                        {
                            damageToPlayer /= 2;
                            UIManager.SlowPrint($"{_player.Name} braces for the hit!", ConsoleColor.White);
                        }

                        if (damageToPlayer < 1)
                        {
                            damageToPlayer = 1;
                        }

                        _player.Health -= damageToPlayer;
                        UIManager.SlowPrint($"The {actingMonster.Name} attacks, dealing {damageToPlayer} damage to you!", ConsoleColor.Red);
                    }
                    else
                    {
                        // It's a miss.
                        UIManager.SlowPrint($"The {actingMonster.Name} attacks and misses!", ConsoleColor.Gray);
                    }
                }
                UIManager.SlowPrint($"\n---------END OF ROUND {round}-----------");
                UIManager.SlowPrint($"{_player.Name}: {_player.Health}/{_player.MaxHealth}");
                UIManager.SlowPrint($"Energy: {_player.Energy}/{_player.MaxEnergy}");
                UIManager.SlowPrint($"{monsterToFight.Name}: {monsterToFight.Health}/{monsterToFight.MaxHealth}");
                UIManager.SlowPrint($"Energy: {monsterToFight.Energy}/{monsterToFight.MaxEnergy}");
                UIManager.SlowPrint("\n----------------------------------");
            }
            round++;
        }

        Console.WriteLine("\n--- BATTLE OVER ---");

        // Check for winners
        if (_player.Health > 0)
        {
            UIManager.SlowPrint($"You defeated the {monsterToFight.Name}!");

            if (monsterToFight is Boss)
            {
                // Check if this is the FINAL floor
                if (_currentFloor == 5)
                {
                    UIManager.SlowPrint("You have defeated the final boss!", ConsoleColor.Yellow);
                    UIManager.SlowPrint("The dungeon crumbles... you are victorious!", ConsoleColor.Yellow);
                    UIManager.SlowPrint("For now...", ConsoleColor.Red);
                    return CombatResult.PlayerVictoryAndGameWon; // Send the "Game Won" signal
                }
                else // It's a regular floor boss, spawn the stairs
                {
                    if (_player.CurrentRoom != null && _gameData.StairsDown != null)
                    {
                        UIManager.SlowPrint("A staircase reveals itself!", ConsoleColor.Yellow);
                        _player.CurrentRoom.ItemsInRoom.Add(_gameData.StairsDown);
                    }
                }
            }
            if (monsterToFight.Loot != null)
            {
                UIManager.SlowPrint($"You found a {monsterToFight.Loot.Name}!");
                _player.Inventory.Add(monsterToFight.Loot);
            }

            // Calculate experience and level up
            _player.AddExperience(monsterToFight.ExperienceValue);
            UIManager.SlowPrint($"Experience: {_player.Experience} / {_player.ExperienceToNextLevel}");
            CheckForLevelUps();
            return CombatResult.PlayerVictory;
        }
        else
        {
            return CombatResult.PlayerDefeat;
        }
    }

    private void DescribeRoom()
    {
        if (_player.CurrentRoom == null)
        {
            Console.WriteLine("You are lost in a void...");
            return;
        }

        UIManager.SlowPrint($"\nLocation: {_player.CurrentRoom.Name} ({_player.CurrentRoom.X}, {_player.CurrentRoom.Y})");
        UIManager.SlowPrint(_player.CurrentRoom.Description);

        // --- MONSTER OR ITEM LIST ---
        if (_player.CurrentRoom.MonstersInRoom.Any())
        {
            UIManager.SlowPrint("\nDangerous creatures lurk here:");
            foreach (Monster monster in _player.CurrentRoom.MonstersInRoom)
            {
                UIManager.SlowPrint($"- A fearsome {monster.Name}", ConsoleColor.Red);
            }
        }
        else
        {
            if (_player.CurrentRoom.ItemsInRoom.Any())
            {
                UIManager.SlowPrint("\nYou found treasure in this room:");
                foreach (Item item in _player.CurrentRoom.ItemsInRoom)
                {
                    UIManager.SlowPrint($"- {item.Name}", ConsoleColor.Green);
                }
            }
        }
    }

    private CombatResult MovePlayer(Room? newRoom)
    {
        if (newRoom != null)
        {
            // Check for boss room and confirm
            if (newRoom.Name == "Boss Chamber")
            {
                UIManager.SlowPrint("You sense a foul stench coming from the other side of this door...", ConsoleColor.Red);
                UIManager.SlowPrint("There is a boss on the other side", ConsoleColor.Red);
                UIManager.SlowPrint("Do you want to proceed?", ConsoleColor.Red);
                Console.Write("(y/n)> ");
                string? input = Console.ReadLine();
                if (input?.ToLower() != "y")
                {
                    UIManager.SlowPrint("You decide to stay back and prepare yourself...", ConsoleColor.Yellow);
                    return CombatResult.InProgress;
                }
                else
                {
                    UIManager.SlowPrint("You bravely step into the chamber...", ConsoleColor.Yellow);
                }
            }

            // Move the player to the new room
            _player.CurrentRoom = newRoom;
            _player.VisitedRooms.Add(newRoom);
            DescribeRoom();

            // Trigger combat if it is a monster room
            while (_player.CurrentRoom != null &&
               _player.CurrentRoom.MonstersInRoom.Count > 0 &&
               _player.Health > 0)
            {
                Monster monster = _player.CurrentRoom.MonstersInRoom[0];
                CombatResult combatResult = StartCombat(monster);

                if (combatResult == CombatResult.PlayerVictory)
                {
                    _player.CurrentRoom.MonstersInRoom.Remove(monster);
                }
                else
                {
                    // If player was defeated OR won the whole game, signal back
                    return combatResult;
                }
            }
        }
        else
        {
            Console.WriteLine("You can't go that way.");
        }
        return CombatResult.PlayerVictory;
    }

    private void DrawMap()
    {
        // null guard
        if (_player.CurrentRoom == null)
        {
            Console.WriteLine("Player is not in the room, how did you do that?");
            return; // Exit the method early
        }

        // Find the boundaries of the discovered map.
        int minX = _player.VisitedRooms.Min(r => r.X);
        int maxX = _player.VisitedRooms.Max(r => r.X);
        int minY = _player.VisitedRooms.Min(r => r.Y);
        int maxY = _player.VisitedRooms.Max(r => r.Y);

        Console.WriteLine("\n--- Dungeon Map ---");

        // Loop through the grid from top to bottom.
        for (int y = maxY; y >= minY; y--)
        {
            // A string for each row of the map.
            string line = "";
            for (int x = minX; x <= maxX; x++)
            {
                // Check if the player is at the current coordinate.
                if (_player.CurrentRoom.X == x && _player.CurrentRoom.Y == y)
                {
                    line += "[P]"; // Player's position
                }
                // Check if a visited room exists at the current coordinate.
                else if (_player.VisitedRooms.Any(r => r.X == x && r.Y == y))
                {
                    if (_player.VisitedRooms.First(r => r.X == x && r.Y == y).MonstersInRoom.Any())
                    {
                        line += "[M]"; // Room with monsters
                    }
                    else if (_player.VisitedRooms.First(r => r.X == x && r.Y == y).ItemsInRoom.Any())
                    {
                        line += "[T]"; // Room with items
                    }
                    else if (_player.VisitedRooms.First(r => r.X == x && r.Y == y).Name == "Boss Chamber")
                    {
                        line += "[B]"; // Boss room
                    }
                    else
                    {
                        line += "[#]"; // Visited room
                    }
                }
                else
                {
                    line += "   "; // Empty, undiscovered space
                }
            }
            Console.WriteLine(line);
        }
        Console.WriteLine("-------------------");
        Console.WriteLine("Legend: P=Player, M=Monsters, T=Treasure, B=Boss");
    }

    private void HandleTalentSelection()
    {
        // Check if there are any talents defined for the player's current class and level.
        if (_gameData.ClassTalents.ContainsKey(_player.Class) &&
            _gameData.ClassTalents[_player.Class].ContainsKey(_player.Level))
        {
            UIManager.SlowPrint("You have a new talent point to spend!", ConsoleColor.Magenta);

            // Get the list of available talents for this tier.
            var availableTalents = _gameData.ClassTalents[_player.Class][_player.Level];

            while (true)
            {
                UIManager.SlowPrint("Choose your talent:", ConsoleColor.Magenta);
                // Display the options
                for (int i = 0; i < availableTalents.Count; i++)
                {
                    Console.WriteLine($"{i + 1}. {availableTalents[i].Name} - {availableTalents[i].Description}");
                }

                Console.Write("> ");
                string? input = Console.ReadLine();

                // Try to parse the input as a number
                if (int.TryParse(input, out int choice) && choice > 0 && choice <= availableTalents.Count)
                {
                    // Get the chosen modifier
                    Modifier chosenTalent = availableTalents[choice - 1];

                    // Apply it to the player
                    chosenTalent.Apply(_player);
                    break; // Exit the selection loop
                }
                else
                {
                    Console.WriteLine("Invalid choice.");
                }
            }
        }
    }
    private void CheckForLevelUps()
    {
        // Loop as long as the player has enough XP to level up
        while (_player.Experience >= _player.ExperienceToNextLevel)
        {
            _player.Level++;
            _player.Experience -= _player.ExperienceToNextLevel;

            UIManager.SlowPrint($"\n*** You have reached Level {_player.Level}! ***", ConsoleColor.Yellow);

            // --- Class-based stat increases ---
            int healthIncrease = 0;
            int strengthIncrease = 0;
            int dexterityIncrease = 0;
            int intellectIncrease = 0;
            int energyIncrease = 0;

            switch (_player.Class)
            {
                case PlayerClass.Warrior:
                    healthIncrease = 15;
                    strengthIncrease = 3;
                    dexterityIncrease = 1;
                    intellectIncrease = 0;
                    energyIncrease = 2;
                    break;
                case PlayerClass.Rogue:
                    healthIncrease = 10;
                    strengthIncrease = 1;
                    dexterityIncrease = 3;
                    intellectIncrease = 1;
                    energyIncrease = 3;
                    break;
                case PlayerClass.Mage:
                    healthIncrease = 8;
                    strengthIncrease = 1;
                    dexterityIncrease = 1;
                    intellectIncrease = 3;
                    energyIncrease = 5;
                    break;
            }
            _player.MaxHealth += healthIncrease;
            _player.MaxEnergy += energyIncrease;
            _player.Stats["Strength"] += strengthIncrease;
            _player.Stats["Dexterity"] += dexterityIncrease;
            _player.Stats["Intellect"] += intellectIncrease;
            _player.Health = _player.MaxHealth;
            _player.Energy = _player.MaxEnergy;
            _player.ExperienceToNextLevel = _player.Level * 100;

            UIManager.SlowPrint($"Max Health increased by {healthIncrease}.", ConsoleColor.DarkYellow);
            UIManager.SlowPrint($"Max Energy increased by {energyIncrease}.", ConsoleColor.DarkYellow);
            UIManager.SlowPrint($"Strength increased by {strengthIncrease}.", ConsoleColor.DarkYellow);
            UIManager.SlowPrint($"Dexterity increased by {dexterityIncrease}.", ConsoleColor.DarkYellow);
            UIManager.SlowPrint($"Intellect increased by {intellectIncrease}.", ConsoleColor.DarkYellow);
            UIManager.SlowPrint($"Recovered to full Health and Energy.", ConsoleColor.DarkYellow);
            UIManager.SlowPrint($"Experience to next level: {_player.ExperienceToNextLevel}", ConsoleColor.DarkYellow);

            HandleTalentSelection();
        }
    }
}
--- Systems/Modifier.cs ---
namespace csharp_roguelike_rpg.Systems;
using csharp_roguelike_rpg.Characters;

public abstract class Modifier
{
    public string? Name { get; protected set; }
    public string? Description { get; protected set; }
    public Rarity Rarity { get; protected set; }

    public abstract void Apply(Player player);
}
--- Systems/PlayerClass.cs ---
namespace csharp_roguelike_rpg.Systems;
public enum PlayerClass
{
    Warrior,
    Rogue,
    Mage,
}
--- Systems/Rarity.cs ---
namespace csharp_roguelike_rpg.Systems;
public enum Rarity
{
    Common,     // Gray
    Uncommon,   // Green
    Heroic,     // Blue
    Epic,       // Purple
    Legendary,  // Orange
    Unique      // Red
}
--- Systems/StatModifier.cs ---
namespace csharp_roguelike_rpg.Systems;

using System.Net;
using csharp_roguelike_rpg.Characters;

public class StatModifier : Modifier
{
    private readonly string _statToModify;
    private readonly int _amount;
    private readonly string _statToPenalize;
    private readonly int _penalty;

    public StatModifier(string name, string description, Rarity rarity, string statToModify, int amount, string statToPenalize, int penalty)
    {
        Name = name;
        Description = description;
        Rarity = rarity;
        _statToModify = statToModify;
        _amount = amount;
        _statToPenalize = statToPenalize;
        _penalty = penalty;
    }

    public override void Apply(Player player)
    {
        if (player.Stats.ContainsKey(_statToPenalize))
        {
            if (_statToPenalize == "null")
            {
                player.Stats[_statToModify] += _amount;
                UIManager.SlowPrint($"Your {_statToModify} has permanently increased by {_amount}!", ConsoleColor.Green);
            }
            else if (_statToPenalize != "null")
            {
                player.Stats[_statToModify] += _amount;
                player.Stats[_statToPenalize] -= _penalty;
                UIManager.SlowPrint($"Your {_statToModify} has permanently increased by {_amount}!", ConsoleColor.Green);
                UIManager.SlowPrint($"Your {_statToPenalize} has permanently decreased by {_amount}!", ConsoleColor.Red);
            }

        }
        else
        {
            player.Stats[_statToModify] += _amount;
            UIManager.SlowPrint($"Your {_statToModify} has permanently increased by {_amount}!", ConsoleColor.Green);
        }
    }
}
--- Systems/UIManager.cs ---
namespace csharp_roguelike_rpg.Systems;
public static class UIManager
{
    public static void SlowPrint(string text, ConsoleColor? color = null)
    {
        if (color.HasValue)
        {
            Console.ForegroundColor = color.Value;
        }

        foreach (char c in text)
        {
            Console.Write(c);
            Thread.Sleep(25);
        }

        Console.ResetColor();
        Console.WriteLine();
    }
}
--- World/DungeonGenerator.cs ---
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Items;
using csharp_roguelike_rpg.Systems;
namespace csharp_roguelike_rpg.World;

public class DungeonGenerator
{
    private Random _random = new Random();
    private GameData _gameData;

    public DungeonGenerator(GameData gameData)
    {
        _gameData = gameData;
    }

    public Room Generate(int numberOfRooms, int floorLevel)
    {
        // --- INITIALIZATION ---
        var map = new Dictionary<string, Room>();
        Room currentRoom = new Room(0, 0);
        map.Add("0,0", currentRoom);
        Room startRoom = currentRoom;

        // --- MAIN LOOP ---
        for (int i = 0; i < numberOfRooms - 1; i++)
        {
            // Choose a random direction (0=North, 1=East, 2=South, 3=West)
            int direction = _random.Next(4);

            // Calculate coordinates of potential next room
            int nextX = currentRoom.X;
            int nextY = currentRoom.Y;
            switch (direction)
            {
                case 0: nextY++; break; //  North
                case 1: nextX++; break; //  East
                case 2: nextY--; break; //  South
                case 3: nextX--; break; //  West
            }

            string nextPositionKey = $"{nextX},{nextY}";
            Room? nextRoom;

            // Check if a room already exists at the new coordinates
            if (!map.TryGetValue(nextPositionKey, out nextRoom))
            {
                // Create a new room if it doesn't exists
                nextRoom = new Room(nextX, nextY);
                map.Add(nextPositionKey, nextRoom);

                // --- MONSTER & ITEM SPAWNING ---
                if (i == numberOfRooms - 2)
                {
                    // --- SPAWN THE BOSS ---
                    Monster bossTemplate = _gameData.MasterBossTable[floorLevel - 1]; // Select boss based on floor level
                    Monster bossForRoom = bossTemplate.Clone();         // Scale the clone
                    nextRoom.MonstersInRoom.Add(bossForRoom);

                    nextRoom.Name = "Boss Chamber";
                    nextRoom.Description = $"A massive {bossForRoom.Name} roars, shaking the very foundations of the dungeon!";
                }
                else if (_random.Next(100) < 50)
                {
                    // --- SPAWN A RANDOM MONSTER ---
                    Monster monsterTemplate = _gameData.MasterMonsterTable[_random.Next(_gameData.MasterMonsterTable.Count)];
                    Monster monsterForRoom = monsterTemplate.Clone(); // Clone the template
                    monsterForRoom.ScaleStats(floorLevel);          // Scale the clone
                    nextRoom.MonstersInRoom.Add(monsterForRoom);

                    nextRoom.Name = "Monster Room";
                    nextRoom.Description = $"The air is thick with the stench of death and decay.";
                }
                else
                {
                    if (_random.Next(100) < 10)
                    {
                        nextRoom.Name = "Fountain Room";
                        nextRoom.Description = "A faint blue light emanates from the center of the room, where a small fountain gurgles with glowing water. It seems safe to drink.";
                    }
                    else
                    {
                        int randomIndex = _random.Next(_gameData.MasterLootTable.Count);
                        Item lootItem = _gameData.MasterLootTable[randomIndex];
                        nextRoom.ItemsInRoom.Add(lootItem);

                        nextRoom.Name = "Treasure Room";
                        nextRoom.Description = $"You feel a sense of calm here, a brief respite from the darkness.";
                    }
                }

                // Link the new room to the current room
                switch (direction)
                {
                    case 0: // Moved North
                        currentRoom.North = nextRoom;
                        nextRoom.South = currentRoom;
                        break;
                    case 1: // Moved East
                        currentRoom.East = nextRoom;
                        nextRoom.West = currentRoom;
                        break;
                    case 2: // Moved South
                        currentRoom.South = nextRoom;
                        nextRoom.North = currentRoom;
                        break;
                    case 3: // Moved West
                        currentRoom.West = nextRoom;
                        nextRoom.East = currentRoom;
                        break;
                }
            }
            // Main walker logic: 80% chance to continue the current path. 
            // The 20% chance to jump to a random existing room encourages branching for a less linear map.
            if (_random.Next(100) < 80)
            {
                currentRoom = nextRoom;
            }
            else
            {
                var allRooms = map.Values.ToList();
                currentRoom = allRooms[_random.Next(allRooms.Count)];
            }
        }
        // --- RETURN TO START ---
        return startRoom;
    }
}
--- World/Room.cs ---
using csharp_roguelike_rpg.Characters;
using csharp_roguelike_rpg.Items;

namespace csharp_roguelike_rpg.World;
public class Room
{
    public string Name { get; set; }
    public string Description { get; set; }
    public List<Monster> MonstersInRoom { get; set; }
    public List<Item> ItemsInRoom { get; set; }

    // Coordinates on the map grid
    public int X { get; set; }
    public int Y { get; set; }

    // Connection to other rooms
    public Room? North { get; set; }
    public Room? South { get; set; }
    public Room? East { get; set; }
    public Room? West { get; set; }

    public Room(int x, int y)
    {
        X = x;
        Y = y;
        Name = "Empty Room";
        Description = "A dusty, featureless stone room.";
        MonstersInRoom = new List<Monster>();
        ItemsInRoom = new List<Item>();
    }
}
--- csharp-roguelike-rpg.csproj ---
ï»¿<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net8.0</TargetFramework>
    <RootNamespace>csharp_roguelike_rpg</RootNamespace>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>

</Project>

